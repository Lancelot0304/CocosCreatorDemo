{"version":3,"sources":["assets/bundles/lock_step_scene/script/GameWorld.ts","assets/bundles/lock_step_scene/script/LockStepScene.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AAAA;AACI;AACA;AACA;AACJ;AAEA;AAAA;AAEY;AACA;AACA;AACA;AACA;AACA;AAuDZ;AArDW;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACJ;AAEO;AACH;AACA;AACA;AACA;AACJ;AAEO;AACH;AACA;AACI;AACH;AACL;AAEQ;AACJ;AACI;AACA;AACA;AACH;AACL;AAEQ;AAER;AAEA;AACI;AACJ;AAEA;AACI;AACJ;AAEA;AACI;AACA;AACA;AACA;AACJ;AACJ;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpEA;AACA;AACA;AACA;AAEA;AAGM;AAGN;AAA2C;AAA3C;AAAA;AACY;AAGR;;AAwCJ;AAtCI;AAEO;AACH;AACJ;AACO;AAEP;AACO;AAEP;AACO;AACH;AACJ;AACO;AACH;AACA;AACJ;AACO;AACH;AACJ;AACO;AACH;AACJ;AACO;AAEP;AACO;AAEP;AAEQ;AACJ;AACA;AACA;AACA;AACJ;AAtCA;AADC;AACuB;AAJP;AADpB;AACoB;AA4CrB;AA5CA;AAAqB","sourcesContent":["\r\nexport enum GWSEventName {\r\n    OnReconnect = \"onReconnect\",\r\n    OnFrame = \"onFrame\",\r\n    OnSyncFrame = \"onSyncFrame\",\r\n}\r\n\r\nexport default class GameWorld {\r\n\r\n    private _timeDelta: number = 0;\r\n    private _frameDuration: number = 0;\r\n    private _gameDuration: number = 0;\r\n    private _timeScale: number = 0;\r\n    private _msgArray: any[] = [];\r\n    private _synced: boolean = false;\r\n\r\n    public start() {\r\n        // PomeloSocketCenter.getInstance().on(GWSEventName.OnReconnect, this.onReconnect, this);\r\n        // PomeloSocketCenter.getInstance().on(GWSEventName.OnFrame, this.onFrame, this);\r\n        // PomeloSocketCenter.getInstance().on(GWSEventName.OnSyncFrame, this.onSyncFrame, this);\r\n        // var host = \"127.0.0.1\";\r\n        // var port = \"3010\";\r\n        // PomeloSocketCenter.getInstance().init(host, port, true, () => {\r\n        //     PomeloSocketCenter.getInstance().request(\"connector.entryHandler.entry\", \"hello pomelo\", function (data) {\r\n        //         cc.log(data.msg);\r\n        //     });\r\n        // })\r\n    }\r\n\r\n    public end() {\r\n        // PomeloSocketCenter.getInstance().off(GWSEventName.OnReconnect, this.onReconnect, this);\r\n        // PomeloSocketCenter.getInstance().off(GWSEventName.OnFrame, this.onFrame, this);\r\n        // PomeloSocketCenter.getInstance().off(GWSEventName.OnSyncFrame, this.onSyncFrame, this);\r\n        // PomeloSocketCenter.getInstance().disconnect();\r\n    }\r\n\r\n    public update(dt: number) {\r\n        this._timeDelta += dt * this._timeScale;\r\n        while (this._timeDelta > this._frameDuration) {\r\n            this.frameUpdate();\r\n        }\r\n    }\r\n\r\n    private frameUpdate() {\r\n        if (this._synced) {\r\n            this.updateEntities(this._frameDuration);\r\n            this._timeDelta -= this._frameDuration;\r\n            this._gameDuration += this._frameDuration;\r\n        }\r\n    }\r\n\r\n    private updateEntities(dt: number) {\r\n\r\n    }\r\n\r\n    onFrame(data: any) {\r\n        this._msgArray.push(data)\r\n    }\r\n\r\n    onReconnect(data: any) {\r\n        // PomeloSocketCenter.getInstance().notify(GWSEventName.OnSyncFrame, { \"game_duration\": this._gameDuration })\r\n    }\r\n\r\n    onSyncFrame(data: any) {\r\n        this._timeDelta = data.gameDelta;\r\n        this._gameDuration = data.gameDuration;\r\n        this._msgArray = data.msgArray;\r\n        this._synced = true;\r\n    }\r\n}","\r\nimport SceneBase from \"../../../scripts/Frameworks/SceneDirector/SceneBase\";\r\nimport { AssetBundleID, SceneName } from \"../../../scripts/Defines/Defines\";\r\nimport PreloadBundleInfo from \"../../../scripts/Frameworks/SceneDirector/PreloadAssetInfo\";\r\nimport IGame from \"../../../scripts/Frameworks/IGame/IGame\";\r\nimport SceneEnterParamBase from \"../../../scripts/Frameworks/SceneDirector/SceneEnterParamBase\";\r\nimport GameWorld from \"./GameWorld\";\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class LockStepScene extends SceneBase {\r\n    private _gameWorld: GameWorld = null;\r\n\r\n    @property(cc.Node)\r\n    quitBtn: cc.Node = null;\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    public getSceneName(): string {\r\n        return SceneName.LockStepScene;\r\n    }\r\n    public onSceneLoad(): void {\r\n\r\n    }\r\n    public onSceneEnable(): void {\r\n\r\n    }\r\n    public onSceneEnter(param: SceneEnterParamBase): void {\r\n        this.quitBtn.on(cc.Node.EventType.TOUCH_END, this.onQuitBtn, this);\r\n    }\r\n    public onSceneStart(): void {\r\n        this._gameWorld = new GameWorld();\r\n        this._gameWorld.start();\r\n    }\r\n    public onSceneUpdate(dt: number): void {\r\n        this._gameWorld.update(dt);\r\n    }\r\n    public onSceneExit(): void {\r\n        this._gameWorld.end();\r\n    }\r\n    public onSceneDisable(): void {\r\n\r\n    }\r\n    public onSceneDestroy(): void {\r\n\r\n    }\r\n\r\n    private onQuitBtn(event: cc.Event.EventCustom) {\r\n        let preloadInfo = PreloadBundleInfo.create();\r\n        preloadInfo.extiBundles = [AssetBundleID.LockStepScene];\r\n        preloadInfo.enterBundles[AssetBundleID.MainScene] = [];\r\n        IGame.getInstance().replaceSceneWithSwitchScene(preloadInfo, SceneName.MainScene);\r\n    }\r\n\r\n}\r\n"],"file":"index.js"}