window.__require=function t(e,r,o){function n(a,c){if(!r[a]){if(!e[a]){var s=a.split("/");if(s=s[s.length-1],!e[s]){var u="function"==typeof __require&&__require;if(!c&&u)return u(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+a+"'")}a=s}var p=r[a]={exports:{}};e[a][0].call(p.exports,function(t){return n(e[a][1][t]||t)},p,p.exports,t,e,r,o)}return r[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<o.length;a++)n(o[a]);return n}({CandyBase:[function(t,e,r){"use strict";cc._RF.push(e,"3261eGk7pBIbKFMoUK064Eb","CandyBase");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../Base/UnitBase"),c=t("../../Base/UnitDefines"),s=t("./State/CandyStateDrop"),u=t("./State/CandyStateNormal"),p=t("./State/CandyStateTeleport"),l=cc._decorator,f=l.ccclass,y=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._selected=!1,e}return n(e,t),e.prototype.teleportToLogicalPosition=function(t){this.layer.moveUnit(this.getLogicalPostion(),t,!1),this.setCurrentState(p.default.create(this.grid.getPixelPositionWithLogicalPositon(this.getLogicalPostion())))},e.prototype.moveToLogicalPosition=function(t){this.layer.moveUnit(this.getLogicalPostion(),t,!1),this.setCurrentState(s.default.create(this.grid.getPixelPositionWithLogicalPositon(this.getLogicalPostion())))},e.prototype.canDrop=function(){return!0},e.prototype.getSelected=function(){return this._selected},e.prototype.setSelected=function(t){this._selected=t},e.prototype.initCandy=function(e){t.prototype.initUnit.call(this,c.UnitCategory.Candy,e),this.setCurrentState(u.default.create()),this.setSelected(!1)},i([f],e)}(a.default));r.default=y,cc._RF.pop()},{"../../Base/UnitBase":"UnitBase","../../Base/UnitDefines":"UnitDefines","./State/CandyStateDrop":"CandyStateDrop","./State/CandyStateNormal":"CandyStateNormal","./State/CandyStateTeleport":"CandyStateTeleport"}],CandyCake:[function(t,e,r){"use strict";cc._RF.push(e,"a92c90KZoVOPZCh3RzEz+b8","CandyCake");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../../Utils/DropSceneAssetCache"),c=t("../../Base/UnitDefines"),s=t("../Base/CandyBase"),u=cc._decorator,p=u.ccclass,l=u.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.doll=null,e.mark=null,e}var r;return n(e,t),r=e,e.create=function(t){var e=a.default.getPrefab("prefab/Game/Unit/Candy/Cake/CandyCake");if(e){var o=cc.instantiate(e);if(o){var n=o.getComponent(r);if(n)return n.initWithHealthPoint(t),n}}return null},e.prototype.canDrop=function(){return!1},e.prototype.setHp=function(e){e=Math.min(4,Math.max(1,e)),t.prototype.setHp.call(this,e);var r="texture/Game/Candy/Cake/6080"+this.getHP().toString();this.doll.spriteFrame=a.default.getSpriteFrame(r)},e.prototype.setSelected=function(e){t.prototype.setSelected.call(this,e),this.mark.active=this.getSelected()},e.prototype.initWithHealthPoint=function(e){t.prototype.initCandy.call(this,c.UnitKind.CandyCake),this.setHp(e)},i([l(cc.Sprite)],e.prototype,"doll",void 0),i([l(cc.Node)],e.prototype,"mark",void 0),r=i([p],e)}(s.default);r.default=f,cc._RF.pop()},{"../../../Utils/DropSceneAssetCache":"DropSceneAssetCache","../../Base/UnitDefines":"UnitDefines","../Base/CandyBase":"CandyBase"}],CandyFactory:[function(t,e,r){"use strict";cc._RF.push(e,"86416ehP31GbZi5KjjIQ0UR","CandyFactory"),Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Base/UnitDefines"),n=t("./Cake/CandyCake"),i=t("./Fruit/CandyFruit"),a=function(){function t(){}return t.createCandy=function(t){switch(t.kind){case o.UnitKind.CandyFruit:var e=t.color||o.UnitColor.Red;return i.default.create(e);case o.UnitKind.CandyCake:var r=t.healthPoint||1;return n.default.create(r)}return null},t}();r.default=a,cc._RF.pop()},{"../Base/UnitDefines":"UnitDefines","./Cake/CandyCake":"CandyCake","./Fruit/CandyFruit":"CandyFruit"}],CandyFruit:[function(t,e,r){"use strict";cc._RF.push(e,"7b1780iioNJ+Zh0jPOnUuYS","CandyFruit");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../../Utils/DropSceneAssetCache"),c=t("../../Base/UnitDefines"),s=t("../Base/CandyBase"),u=cc._decorator,p=u.ccclass,l=u.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.doll=null,e.mark=null,e}var r;return n(e,t),r=e,e.create=function(t){var e=a.default.getPrefab("prefab/Game/Unit/Candy/Fruit/CandyFruit");if(e){var o=cc.instantiate(e);if(o){var n=o.getComponent(r);if(n)return n.initWithColor(t),n}}return null},e.prototype.canDrop=function(){return!0},e.prototype.setColor=function(e){t.prototype.setColor.call(this,e);var r="texture/Game/Candy/Fruit/6010"+e.toString();this.doll.spriteFrame=a.default.getSpriteFrame(r)},e.prototype.setSelected=function(e){t.prototype.setSelected.call(this,e),this.mark.active=this.getSelected()},e.prototype.initWithColor=function(e){t.prototype.initCandy.call(this,c.UnitKind.CandyFruit),this.setColor(e)},i([l(cc.Sprite)],e.prototype,"doll",void 0),i([l(cc.Node)],e.prototype,"mark",void 0),r=i([p],e)}(s.default);r.default=f,cc._RF.pop()},{"../../../Utils/DropSceneAssetCache":"DropSceneAssetCache","../../Base/UnitDefines":"UnitDefines","../Base/CandyBase":"CandyBase"}],CandyLayer:[function(t,e,r){"use strict";cc._RF.push(e,"509b4LPjkNJHZUR/fl2fNJ3","CandyLayer");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../Base/GridLayerBase"),c=cc._decorator,s=c.ccclass,u=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var r;return n(e,t),r=e,e.create=function(t,e){var o=(new cc.Node).addComponent(r);return o.initWithSize(t,e),o},e.prototype.initWithSize=function(e,r){t.prototype.init.call(this,a.LayerName.Candy,e,r)},r=i([s],e)}(a.default));r.default=u,cc._RF.pop()},{"../Base/GridLayerBase":"GridLayerBase"}],CandyStateBorn:[function(t,e,r){"use strict";cc._RF.push(e,"a3ab9H/tKxJqa+7Rffh3olg","CandyStateBorn");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Base/State/UnitStateBase"),a=t("./CandyStateNormal"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._pastDuration=0,e}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,i.UnitStateType.Born)},e.prototype.enter=function(t){t.node.scale=0},e.prototype.update=function(t,e){this._pastDuration+=4*e,t.node.scale=Math.min(this._pastDuration,1),this._pastDuration>=1&&t.setCurrentState(a.default.create())},e}(i.default);r.default=c,cc._RF.pop()},{"../../../Base/State/UnitStateBase":"UnitStateBase","./CandyStateNormal":"CandyStateNormal"}],CandyStateDrop:[function(t,e,r){"use strict";cc._RF.push(e,"1ba9fA9jz5IoIrK6I8Q+h29","CandyStateDrop");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Base/State/UnitStateBase"),a=t("./CandyStateNormal"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._pastDuration=0,e._startPixelPosition=cc.v2(0,0),e._targetPixelPosition=cc.v2(0,0),e}return n(e,t),e.create=function(t){var r=new e;return r.initWithTargetPos(t),r},e.prototype.initWithTargetPos=function(e){t.prototype.init.call(this,i.UnitStateType.Drop),this._targetPixelPosition=e},e.prototype.enter=function(t){t.node.scale=1,this._startPixelPosition=t.getPixelPosition()},e.prototype.update=function(t,e){this._pastDuration+=4*e,t.setPixelPosition(this._startPixelPosition.lerp(this._targetPixelPosition,Math.min(1,this._pastDuration))),this._pastDuration>=1&&t.setCurrentState(a.default.create())},e}(i.default);r.default=c,cc._RF.pop()},{"../../../Base/State/UnitStateBase":"UnitStateBase","./CandyStateNormal":"CandyStateNormal"}],CandyStateNormal:[function(t,e,r){"use strict";cc._RF.push(e,"281859fxtdDQoGL+f/+1eai","CandyStateNormal");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Base/State/UnitStateBase"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,i.UnitStateType.Normal)},e.prototype.enter=function(t){t.node.scale=1},e}(i.default);r.default=a,cc._RF.pop()},{"../../../Base/State/UnitStateBase":"UnitStateBase"}],CandyStateTeleport:[function(t,e,r){"use strict";cc._RF.push(e,"50fffi4O1NBUojeUZc6NyGl","CandyStateTeleport");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Base/State/UnitStateBase"),a=t("./CandyStateNormal"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._pastDuration=0,e._startPixelPosition=cc.v2(0,0),e._targetPixelPosition=cc.v2(0,0),e}return n(e,t),e.create=function(t){var r=new e;return r.initWithTargetPos(t),r},e.prototype.initWithTargetPos=function(e){t.prototype.init.call(this,i.UnitStateType.Drop),this._targetPixelPosition=e},e.prototype.enter=function(t){t.node.scale=1,this._startPixelPosition=t.getPixelPosition()},e.prototype.update=function(t,e){this._pastDuration+=4*e,this._pastDuration<=.5?(t.setPixelPosition(this._startPixelPosition),t.node.scale=1-this._pastDuration/.5):(t.setPixelPosition(this._targetPixelPosition),t.node.scale=Math.min(1,(this._pastDuration-.5)/.5)),this._pastDuration>=1&&t.setCurrentState(a.default.create())},e}(i.default);r.default=c,cc._RF.pop()},{"../../../Base/State/UnitStateBase":"UnitStateBase","./CandyStateNormal":"CandyStateNormal"}],DropSceneAssetCache:[function(t,e,r){"use strict";cc._RF.push(e,"7833aeCQLFB/Y4OgEWklgSu","DropSceneAssetCache"),Object.defineProperty(r,"__esModule",{value:!0});var o=t("../../../../../scripts/Defines/Defines"),n=t("../../../../../scripts/Frameworks/AssetCache/AssetCache"),i=function(){function t(){}return t.getAssetSync=function(t,e){return n.default.getInstance().getAssetSync(o.AssetBundleID.DropScene,t,e)},t.getSpriteFrame=function(t){return this.getAssetSync(t,cc.SpriteFrame)},t.getPrefab=function(t){return this.getAssetSync(t,cc.Prefab)},t.getKeyWithLogicalPosition=function(t){return 100*Math.floor(t.y)+Math.floor(t.x)+1e4},t}();r.default=i,cc._RF.pop()},{"../../../../../scripts/Defines/Defines":void 0,"../../../../../scripts/Frameworks/AssetCache/AssetCache":void 0}],DropSceneMath:[function(t,e,r){"use strict";cc._RF.push(e,"36a34HMOuBOZLcD2Ky8MgZv","DropSceneMath"),Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(){}return t.getKeyWithLogicalPosition=function(t){return 100*Math.floor(t.y)+Math.floor(t.x)+1e4},t}();r.default=o,cc._RF.pop()},{}],DropScene:[function(t,e,r){"use strict";cc._RF.push(e,"75f3c4PzuJJjrw+K38mcqO7","DropScene");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../../scripts/Defines/Defines"),c=t("../../../scripts/Frameworks/IGame/IGame"),s=t("../../../scripts/Frameworks/SceneDirector/PreloadAssetInfo"),u=t("../../../scripts/Frameworks/SceneDirector/SceneBase"),p=t("./Game/Grid/Grid"),l=cc._decorator,f=l.ccclass,y=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gridContainer=null,e._grid=null,e}return n(e,t),e.prototype.getSceneName=function(){return a.SceneName.DropScene},e.prototype.onSceneLoad=function(){},e.prototype.onSceneEnable=function(){},e.prototype.onSceneEnter=function(){},e.prototype.onSceneStart=function(){this._grid=p.default.create(1,this.gridContainer.getContentSize(),cc.size(75,75),cc.size(9,12)),this.gridContainer.addChild(this._grid.node),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},e.prototype.onSceneUpdate=function(t){this._grid&&this._grid.updateGrid(t)},e.prototype.onSceneExit=function(){},e.prototype.onSceneDisable=function(){},e.prototype.onSceneDestroy=function(){},e.prototype.onStepBtn=function(){this._grid&&this._grid.clearSelectedCandy()},e.prototype.onQuitBtn=function(){var t=s.default.create();t.extiBundles=[a.AssetBundleID.DropScene],t.enterBundles[a.AssetBundleID.MainScene]=[],c.default.getInstance().replaceSceneWithSwitchScene(t,a.SceneName.MainScene)},e.prototype.onTouchStart=function(t){this._grid&&this._grid.onTouchStart(t)},e.prototype.onTouchMove=function(t){this._grid&&this._grid.onTouchMove(t)},e.prototype.onTouchEnd=function(t){this._grid&&this._grid.onTouchEnd(t)},e.prototype.onTouchCancel=function(t){this._grid&&this._grid.onTouchCancel(t)},i([y(cc.Node)],e.prototype,"gridContainer",void 0),i([f],e)}(u.default);r.default=d,cc._RF.pop()},{"../../../scripts/Defines/Defines":void 0,"../../../scripts/Frameworks/IGame/IGame":void 0,"../../../scripts/Frameworks/SceneDirector/PreloadAssetInfo":void 0,"../../../scripts/Frameworks/SceneDirector/SceneBase":void 0,"./Game/Grid/Grid":"Grid"}],FloorBase:[function(t,e,r){"use strict";cc._RF.push(e,"0aa88lvPZ9CrZFCbj5xGJnm","FloorBase");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../Base/UnitBase"),c=t("../../Base/UnitDefines"),s=t("./State/FloorStateNormal"),u=cc._decorator,p=u.ccclass,l=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isSpawn=!1,e}return n(e,t),e.prototype.isSpawn=function(){return this._isSpawn},e.prototype.setIsSpawn=function(t){this._isSpawn=t},e.prototype.initFloor=function(e){t.prototype.initUnit.call(this,c.UnitCategory.Floor,e),this.setCurrentState(s.default.create())},i([p],e)}(a.default));r.default=l,cc._RF.pop()},{"../../Base/UnitBase":"UnitBase","../../Base/UnitDefines":"UnitDefines","./State/FloorStateNormal":"FloorStateNormal"}],FloorEntrance:[function(t,e,r){"use strict";cc._RF.push(e,"c141a8G4jpFi4PeA97RBIqk","FloorEntrance");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../../Utils/DropSceneAssetCache"),c=t("../../Base/UnitDefines"),s=t("../Base/FloorBase"),u=cc._decorator,p=u.ccclass,l=u.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.doll=null,e._exit=cc.v2(0,0),e}var r;return n(e,t),r=e,e.create=function(t){var e=a.default.getPrefab("prefab/Game/Unit/Floor/Entrance/FloorEntrance");if(e){var o=cc.instantiate(e);if(o){var n=o.getComponent(r);if(n)return n.initWithExit(t),n}}return null},e.prototype.getExit=function(){return this._exit},e.prototype.setExit=function(t){this._exit=t},e.prototype.initWithExit=function(e){t.prototype.initFloor.call(this,c.UnitKind.FloorEntrance),this.setExit(e),this.node.zIndex=1},i([l(cc.Sprite)],e.prototype,"doll",void 0),r=i([p],e)}(s.default);r.default=f,cc._RF.pop()},{"../../../Utils/DropSceneAssetCache":"DropSceneAssetCache","../../Base/UnitDefines":"UnitDefines","../Base/FloorBase":"FloorBase"}],FloorExit:[function(t,e,r){"use strict";cc._RF.push(e,"1ee4dYw4idFO6ca03QlrMNp","FloorExit");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../../Utils/DropSceneAssetCache"),c=t("../../Base/UnitDefines"),s=t("../Base/FloorBase"),u=cc._decorator,p=u.ccclass,l=u.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.doll=null,e._entrance=cc.v2(0,0),e}var r;return n(e,t),r=e,e.create=function(t){var e=a.default.getPrefab("prefab/Game/Unit/Floor/Exit/FloorExit");if(e){var o=cc.instantiate(e);if(o){var n=o.getComponent(r);if(n)return n.initWithEntrance(t),n}}return null},e.prototype.getEntrance=function(){return this._entrance},e.prototype.setEntrance=function(t){this._entrance=t},e.prototype.initWithEntrance=function(e){t.prototype.initFloor.call(this,c.UnitKind.FloorExit),this.setEntrance(e),this.node.zIndex=1},i([l(cc.Sprite)],e.prototype,"doll",void 0),r=i([p],e)}(s.default);r.default=f,cc._RF.pop()},{"../../../Utils/DropSceneAssetCache":"DropSceneAssetCache","../../Base/UnitDefines":"UnitDefines","../Base/FloorBase":"FloorBase"}],FloorFactory:[function(t,e,r){"use strict";cc._RF.push(e,"2d17dCcTqpK97/GNkBxzQ4L","FloorFactory"),Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Base/UnitDefines"),n=t("./Entrance/FloorEntrance"),i=t("./Exit/FloorExit"),a=t("./Fixed/FloorFixed"),c=function(){function t(){}return t.createFloor=function(t){switch(t.kind){case o.UnitKind.FloorFixed:return a.default.create();case o.UnitKind.FloorEntrance:var e=t.relatedPosition||cc.v2(-1,-1);return n.default.create(e);case o.UnitKind.FloorExit:var r=t.relatedPosition||cc.v2(-1,-1);return i.default.create(r)}return null},t}();r.default=c,cc._RF.pop()},{"../Base/UnitDefines":"UnitDefines","./Entrance/FloorEntrance":"FloorEntrance","./Exit/FloorExit":"FloorExit","./Fixed/FloorFixed":"FloorFixed"}],FloorFixed:[function(t,e,r){"use strict";cc._RF.push(e,"c95f63X/y9FYaAStQOs8xau","FloorFixed");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../../Utils/DropSceneAssetCache"),c=t("../../Base/UnitDefines"),s=t("../Base/FloorBase"),u=cc._decorator,p=u.ccclass,l=u.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.doll=null,e}var r;return n(e,t),r=e,e.create=function(){var t=a.default.getPrefab("prefab/Game/Unit/Floor/Fixed/FloorFixed");if(t){var e=cc.instantiate(t);if(e){var o=e.getComponent(r);if(o)return o.init(),o}}return null},e.prototype.init=function(){t.prototype.initFloor.call(this,c.UnitKind.FloorFixed)},i([l(cc.Sprite)],e.prototype,"doll",void 0),r=i([p],e)}(s.default);r.default=f,cc._RF.pop()},{"../../../Utils/DropSceneAssetCache":"DropSceneAssetCache","../../Base/UnitDefines":"UnitDefines","../Base/FloorBase":"FloorBase"}],FloorLayer:[function(t,e,r){"use strict";cc._RF.push(e,"f497c2CCC1O4arw/ElvVr2O","FloorLayer");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../Base/GridLayerBase"),c=cc._decorator,s=c.ccclass,u=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var r;return n(e,t),r=e,e.create=function(t,e){var o=(new cc.Node).addComponent(r);return o.initWithSize(t,e),o},e.prototype.initWithSize=function(e,r){t.prototype.init.call(this,a.LayerName.Floor,e,r)},r=i([s],e)}(a.default));r.default=u,cc._RF.pop()},{"../Base/GridLayerBase":"GridLayerBase"}],FloorStateNormal:[function(t,e,r){"use strict";cc._RF.push(e,"480bbL+kPZHM6xni7kPXl3N","FloorStateNormal");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Base/State/UnitStateBase"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,i.UnitStateType.Normal)},e}(i.default);r.default=a,cc._RF.pop()},{"../../../Base/State/UnitStateBase":"UnitStateBase"}],FrameBase:[function(t,e,r){"use strict";cc._RF.push(e,"caa2ec9LLZBTry6sBN9hdgg","FrameBase");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../Base/UnitBase"),c=t("../../Base/UnitDefines"),s=t("./State/FrameStateNormal"),u=cc._decorator,p=u.ccclass,l=(u.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.initFrame=function(e){t.prototype.initUnit.call(this,c.UnitCategory.Frame,e),this.setCurrentState(s.default.create())},i([p],e)}(a.default));r.default=l,cc._RF.pop()},{"../../Base/UnitBase":"UnitBase","../../Base/UnitDefines":"UnitDefines","./State/FrameStateNormal":"FrameStateNormal"}],FrameFactory:[function(t,e,r){"use strict";cc._RF.push(e,"b4ce8clPXxLz42GDitWvcVt","FrameFactory"),Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Base/UnitDefines"),n=t("./Normal/FrameNormal"),i=function(){function t(){}return t.createFrame=function(t){switch(t.kind){case o.UnitKind.FrameNormal:return n.default.create()}return null},t}();r.default=i,cc._RF.pop()},{"../Base/UnitDefines":"UnitDefines","./Normal/FrameNormal":"FrameNormal"}],FrameLayer:[function(t,e,r){"use strict";cc._RF.push(e,"07cfdMk0PtE4aoN9OGMYUIq","FrameLayer");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../Base/GridLayerBase"),c=cc._decorator,s=c.ccclass,u=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var r;return n(e,t),r=e,e.create=function(t,e){var o=(new cc.Node).addComponent(r);return o.initWithSize(t,e),o},e.prototype.initWithSize=function(e,r){t.prototype.init.call(this,a.LayerName.Frame,e,r)},r=i([s],e)}(a.default));r.default=u,cc._RF.pop()},{"../Base/GridLayerBase":"GridLayerBase"}],FrameNormal:[function(t,e,r){"use strict";cc._RF.push(e,"4b760xZOj1KR5ZnuWXwiP1m","FrameNormal");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../../Layer/Base/GridLayerBase"),c=t("../../../Utils/DropSceneAssetCache"),s=t("../../Base/UnitDefines"),u=t("../Base/FrameBase"),p=cc._decorator,l=p.ccclass,f=p.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.doll=null,e}var r;return n(e,t),r=e,e.create=function(){var t=c.default.getPrefab("prefab/Game/Unit/Frame/Normal/FrameNormal");if(t){var e=cc.instantiate(t);if(e){var o=e.getComponent(r);if(o)return o.init(),o}}return null},e.prototype.setLogicalPostion=function(e){t.prototype.setLogicalPostion.call(this,e);var r=this.getPositionCode(this.getLogicalPostion()),o="01101";switch(r){case 128:o="00101";break;case 2:o="00102";break;case 8:o="00103";break;case 32:o="00104";break;case 160:o="00201";break;case 130:o="00202";break;case 10:o="00203";break;case 40:o="00204";break;case 136:o="00205";break;case 34:o="00206";break;case 162:o="00301";break;case 138:o="00302";break;case 42:o="00303";break;case 168:o="00304";break;case 170:o="00401";break;case 64:case 96:case 192:case 224:o="00501";break;case 1:case 3:case 129:case 131:o="00502";break;case 4:case 6:case 12:case 14:o="00503";break;case 16:case 24:case 56:case 48:o="00504";break;case 66:case 98:case 194:case 226:o="00601";break;case 72:case 104:case 200:case 232:o="00602";break;case 9:case 11:case 137:case 139:o="00603";break;case 33:case 35:case 161:case 163:o="00604";break;case 36:case 38:case 44:case 46:o="00605";break;case 132:case 134:case 140:case 142:o="00606";break;case 144:case 152:case 176:case 184:o="00607";break;case 18:case 26:case 50:case 58:o="00608";break;case 74:case 106:case 202:case 234:o="00701";break;case 41:case 43:case 169:case 171:o="00702";break;case 164:case 166:case 172:case 174:o="00703";break;case 146:case 154:case 178:case 186:o="00704";break;case 65:case 67:case 97:case 99:case 193:case 195:case 225:case 227:o="00801";break;case 5:case 7:case 13:case 15:case 133:case 135:case 141:case 143:o="00802";break;case 20:case 22:case 28:case 30:case 52:case 54:case 60:case 62:o="00803";break;case 80:case 88:case 112:case 120:case 208:case 216:case 240:case 248:o="00804";break;case 68:case 70:case 76:case 78:case 100:case 102:case 108:case 110:case 196:case 198:case 204:case 206:case 228:case 230:case 236:case 238:o="00805";break;case 17:case 19:case 25:case 27:case 49:case 51:case 57:case 59:case 145:case 147:case 153:case 155:case 177:case 179:case 185:case 187:o="00806";break;case 73:case 75:case 105:case 107:case 201:case 203:case 233:case 235:o="00901";break;case 37:case 39:case 45:case 47:case 165:case 167:case 173:case 175:o="00902";break;case 148:case 150:case 156:case 158:case 180:case 182:case 188:case 190:o="00903";break;case 82:case 90:case 114:case 122:case 210:case 218:case 242:case 250:o="00904";break;case 69:case 71:case 77:case 79:case 101:case 103:case 109:case 111:case 197:case 199:case 205:case 207:case 229:case 231:case 237:case 239:o="01001";break;case 21:case 23:case 29:case 31:case 53:case 55:case 61:case 63:case 149:case 151:case 157:case 159:case 181:case 183:case 189:case 191:o="01002";break;case 84:case 86:case 92:case 94:case 116:case 118:case 124:case 126:case 212:case 214:case 220:case 222:case 244:case 246:case 252:case 254:o="01003";break;case 81:case 83:case 89:case 91:case 113:case 115:case 121:case 123:case 209:case 211:case 217:case 219:case 241:case 243:case 249:case 251:o="01004";break;case 85:case 87:case 93:case 95:case 117:case 119:case 125:case 127:case 213:case 215:case 221:case 223:case 245:case 247:case 253:case 255:o="01101"}var n="texture/Game/Frame/Normal/"+o;this.doll.spriteFrame=c.default.getSpriteFrame(n),this.doll.node.active=0!=r},e.prototype.getPositionCode=function(t){for(var e=0,r=1,o=0,n=[cc.v2(1,0),cc.v2(1,1),cc.v2(0,1),cc.v2(-1,1),cc.v2(-1,0),cc.v2(-1,-1),cc.v2(0,-1),cc.v2(1,-1)];o<n.length;o++){var i=n[o],c=t.add(i);this.grid.getUnit(a.LayerName.Floor,c)&&(e+=r),r*=2}return e},e.prototype.init=function(){t.prototype.initFrame.call(this,s.UnitKind.FrameNormal)},i([f(cc.Sprite)],e.prototype,"doll",void 0),r=i([l],e)}(u.default);r.default=y,cc._RF.pop()},{"../../../Layer/Base/GridLayerBase":"GridLayerBase","../../../Utils/DropSceneAssetCache":"DropSceneAssetCache","../../Base/UnitDefines":"UnitDefines","../Base/FrameBase":"FrameBase"}],FrameStateNormal:[function(t,e,r){"use strict";cc._RF.push(e,"a3028ns8mBF0ppTlJ3qJGR+","FrameStateNormal");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Base/State/UnitStateBase"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,i.UnitStateType.Normal)},e}(i.default);r.default=a,cc._RF.pop()},{"../../../Base/State/UnitStateBase":"UnitStateBase"}],GridDropLogic:[function(t,e,r){"use strict";cc._RF.push(e,"143b4/pvLdI/aGeRqxrTPDW","GridDropLogic");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Layer/Base/GridLayerBase"),a=t("../Base/GridStateBase"),c=t("../../../Utils/DropSceneMath"),s=t("../../../Unit/Base/UnitDefines"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._searchOffsets=[],e._floorStatusDict={},e._wallsDict={},e}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,a.GridStateType.Drop),this._floorStatusDict={},this._wallsDict={},this._searchOffsets.push(cc.v2(0,1)),this._searchOffsets.push(cc.v2(-1,1)),this._searchOffsets.push(cc.v2(1,1))},e.prototype.getFloorStatus=function(t,e,r){void 0===r&&(r=null),null==r&&(r=new Set);var o=c.default.getKeyWithLogicalPosition(e);if(r.has(o))return!1;r.add(o);var n=this._floorStatusDict[o];if(null!=n)return n;var a=t.getUnit(i.LayerName.Floor,e);if(null==a)return this._floorStatusDict[o]=!1,!1;var u=t.getUnit(i.LayerName.Candy,e);if(u&&!u.canDrop())return this._floorStatusDict[o]=!1,!1;if(a.isSpawn())return this._floorStatusDict[o]=!0,!0;if(a.getUnitKind()==s.UnitKind.FloorExit){var p=a;if(this.getFloorStatus(t,p.getEntrance(),r))return this._floorStatusDict[o]=!0,!0}for(var l=t.getMapSize(),f=0,y=this._searchOffsets;f<y.length;f++){var d=y[f],h=e.add(d);if(h.x>=0&&h.x<l.width&&h.y>=0&&h.y<l.height&&0==this.hasWall(e,h)&&this.getFloorStatus(t,h,r))return this._floorStatusDict[o]=!0,!0}return this._floorStatusDict[o]=!1,!1},e.prototype.recordFloorStatus=function(t){for(var e=t.getMapSize(),r=e.height-1;r>-1;r--)for(var o=0;o<e.width;o++){var n=cc.v2(o,r);this.getFloorStatus(t,n)}},e.prototype.getWallKeyWithLogicalPosition=function(t,e){return cc.js.formatStr("{%s,%s}->{%s,%s}",t.x,t.y,e.x,e.y)},e.prototype.hasWall=function(t,e){var r=this.getWallKeyWithLogicalPosition(t,e);return null!=this._wallsDict[r]},e.prototype.recordWalls=function(t){for(var e=t.getMapSize(),r=0;r<e.height;r++)for(var o=0;o<e.width;o++){var n=cc.v2(o,r),a=t.getUnit(i.LayerName.Floor,n);if(a&&a.getUnitKind()==s.UnitKind.FloorEntrance){var c=this.getWallKeyWithLogicalPosition(n,n.add(cc.v2(0,-1)));this._wallsDict[c]=!0;var u=this.getWallKeyWithLogicalPosition(n.add(cc.v2(0,-1)),n);this._wallsDict[u]=!0}a&&a.getUnitKind()==s.UnitKind.FloorExit&&(c=this.getWallKeyWithLogicalPosition(n,n.add(cc.v2(0,1))),this._wallsDict[c]=!0,u=this.getWallKeyWithLogicalPosition(n.add(cc.v2(0,1)),n),this._wallsDict[u]=!0)}},e.prototype.isFloorAvailable=function(t,e){return null!=t.getUnit(i.LayerName.Floor,e)&&null==t.getUnit(i.LayerName.Candy,e)},e.prototype.dropCandy=function(t,e,r,o){var n=t.getUnit(i.LayerName.Candy,e);if(n&&!r.has(n)&&(r.add(n),n.canDrop())){var a=t.getUnit(i.LayerName.Floor,e);if(a.getUnitKind()==s.UnitKind.FloorEntrance){var c=a.getExit();if(this.dropCandy(t,c,r,o),this.isFloorAvailable(t,c))return n.teleportToLogicalPosition(c),o.add(n),!0}var u=e.add(cc.v2(0,-1));if(0==this.hasWall(e,u)&&(this.dropCandy(t,u,r,o),this.isFloorAvailable(t,u)))return n.moveToLogicalPosition(u),o.add(n),!0;var p=e.add(cc.v2(-1,-1));if(0==this.hasWall(e,p)){var l=e.add(cc.v2(-1,0));if((this.hasWall(l,p)||0==this.getFloorStatus(t,l))&&(this.dropCandy(t,p,r,o),this.isFloorAvailable(t,p)))return n.moveToLogicalPosition(p),o.add(n),!0}var f=e.add(cc.v2(1,-1));if(0==this.hasWall(e,f)){var y=e.add(cc.v2(1,0));if((this.hasWall(y,f)||0==this.getFloorStatus(t,y))&&(this.dropCandy(t,f,r,o),this.isFloorAvailable(t,f)))return n.moveToLogicalPosition(f),o.add(n),!0}}return!1},e.prototype.tryDropAllCandy=function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=null),null==e&&(e=new Set),null==r&&(r=new Set);for(var o=t.getMapSize(),n=0;n<o.height;n++)for(var i=0;i<o.width;i++){var a=cc.v2(i,n);this.dropCandy(t,a,e,r)}return r},e.prototype.enter=function(t){this.recordFloorStatus(t),this.recordWalls(t)},e.prototype.onTouchStart=function(t,e){var r=t.getLogicalPositionWithPixelPositon(e),o=this.getFloorStatus(t,r);console.log(cc.js.formatStr("GridDropLogic.onTouchStart Pos{%s,%s} is %s",r.x,r.y,o?"Alive":"Dead"))},e}(a.default);r.default=u,cc._RF.pop()},{"../../../Layer/Base/GridLayerBase":"GridLayerBase","../../../Unit/Base/UnitDefines":"UnitDefines","../../../Utils/DropSceneMath":"DropSceneMath","../Base/GridStateBase":"GridStateBase"}],GridGenerateLogic:[function(t,e,r){"use strict";cc._RF.push(e,"aacebbTp3JAuLeRGzNYuRF0","GridGenerateLogic");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Layer/Base/GridLayerBase"),a=t("../../../Unit/Candy/CandyFactory"),c=t("../../../Unit/Candy/Base/State/CandyStateBorn"),s=t("../Base/GridStateBase"),u=t("../../../Unit/Base/UnitDefines"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._generatedCandy=new Set,e}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,s.GridStateType.Drop)},e.prototype.enter=function(){},e.prototype.generateNewCandy=function(t){this._generatedCandy.clear();for(var e=t.getMapSize(),r=0;r<e.height;r++)for(var o=0;o<e.width;o++){var n=cc.v2(o,r),s=t.getUnit(i.LayerName.Floor,n);if(s&&s.isSpawn()){var p=t.getUnit(i.LayerName.Candy,n);if(null==p){var l=u.UnitColor.End-u.UnitColor.Begin,f=Math.floor(Math.random()*l)+u.UnitColor.Begin,y={kind:u.UnitKind.CandyFruit,color:f};p=a.default.createCandy(y),t.setUnit(i.LayerName.Candy,n,p),p.setCurrentState(c.default.create()),this._generatedCandy.add(p)}}}return this._generatedCandy},e}(s.default);r.default=p,cc._RF.pop()},{"../../../Layer/Base/GridLayerBase":"GridLayerBase","../../../Unit/Base/UnitDefines":"UnitDefines","../../../Unit/Candy/Base/State/CandyStateBorn":"CandyStateBorn","../../../Unit/Candy/CandyFactory":"CandyFactory","../Base/GridStateBase":"GridStateBase"}],GridLayerBase:[function(t,e,r){"use strict";cc._RF.push(e,"15d34h6h6BAeLXM1WiT/ssU","GridLayerBase");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0}),r.LayerName=void 0;var a=t("../../Utils/DropSceneAssetCache"),c=cc._decorator,s=c.ccclass;c.property,function(t){t.None="none",t.Frame="frame",t.Floor="floor",t.Candy="candy"}(r.LayerName||(r.LayerName={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._grid=null,e._size=cc.size(0,0),e._id="",e._unitDict={},e}return n(e,t),Object.defineProperty(e.prototype,"grid",{get:function(){return this._grid},set:function(t){this._grid=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!1,configurable:!0}),e.prototype.getUnit=function(t){var e=this.getKeyWithLogicalPosition(t);return this._unitDict[e]},e.prototype.setUnit=function(t,e){var r=this.getKeyWithLogicalPosition(t),o=this.removeUnit(t);return e.layer=this,e.setPixelPosition(this.grid.getPixelPositionWithLogicalPositon(t)),e.setLogicalPostion(t),this._unitDict[r]=e,this.node.addChild(e.node),o},e.prototype.moveUnit=function(t,e,r){void 0===r&&(r=!0);var o=this.getKeyWithLogicalPosition(t),n=this.getKeyWithLogicalPosition(e);this._unitDict[o]&&null==this._unitDict[n]&&(this._unitDict[n]=this._unitDict[o],this._unitDict[o]=null,this._unitDict[n].setLogicalPostion(e),r&&this._unitDict[n].setPixelPosition(this.grid.getPixelPositionWithLogicalPositon(e)))},e.prototype.removeUnit=function(t,e){void 0===e&&(e=!1);var r=this.getKeyWithLogicalPosition(t);return this.removeUnitWithKey(r,e)},e.prototype.removeUnitWithKey=function(t,e){void 0===e&&(e=!1);var r=this._unitDict[t];return r&&(r.layer=null,r.node.removeFromParent(e),delete this._unitDict[t]),r},e.prototype.getKeyWithLogicalPosition=function(t){return a.default.getKeyWithLogicalPosition(t)},e.prototype.init=function(t,e,r){this.id=t,this.node.setAnchorPoint(0,0),this.node.setContentSize(e),this.size=r},e.prototype.updateLayer=function(t){for(var e=0;e<this.size.height;e++)for(var r=0;r<this.size.width;r++){var o=this.getUnit(cc.v2(r,e));o&&o.updateUnit(t)}},i([s],e)}(cc.Component);r.default=u,cc._RF.pop()},{"../../Utils/DropSceneAssetCache":"DropSceneAssetCache"}],GridStateBase:[function(t,e,r){"use strict";cc._RF.push(e,"7e1f4VS6k5N3bBIS8GIJ6QU","GridStateBase");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.GridStateType=void 0;var i,a=t("../../../../../../../scripts/Frameworks/EWS/FSM/State");(function(t){t[t.None=0]="None",t[t.Create=1]="Create",t[t.Normal=2]="Normal",t[t.Drop=3]="Drop"})(i=r.GridStateType||(r.GridStateType={}));var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._type=i.None,e}return n(e,t),e.prototype.getType=function(){return this._type},e.prototype.init=function(t){this._type=t},e.prototype.enter=function(){},e.prototype.update=function(t,e){var r=t.getLayers();for(var o in r)r[o].updateLayer(e)},e.prototype.exit=function(){},e.prototype.onMessage=function(){return!1},e.prototype.reset=function(){},e.prototype.onTouchStart=function(){},e.prototype.onTouchMove=function(){},e.prototype.onTouchEnd=function(){},e.prototype.onTouchCancel=function(){},e}(a.default);r.default=c,cc._RF.pop()},{"../../../../../../../scripts/Frameworks/EWS/FSM/State":void 0}],GridStateCreate:[function(t,e,r){"use strict";cc._RF.push(e,"483a4xTVO9E2qWrvH0nkTWJ","GridStateCreate");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../../../../../scripts/Defines/Defines"),a=t("../../../../../../../scripts/Frameworks/TiledMap/TiledMapJsonPhraser"),c=t("../../../../../../../scripts/Frameworks/Utils/GameMath"),s=t("../../../Layer/Base/GridLayerBase"),u=t("../../../Layer/FloorLayer/FloorLayer"),p=t("../../../Layer/FrameLayer/FrameLayer"),l=t("../../../Layer/CandyLayer/CandyLayer"),f=t("../../../Unit/Floor/FloorFactory"),y=t("../../../Unit/Candy/CandyFactory"),d=t("../Base/GridStateBase"),h=t("../../../Unit/Frame/FrameFactory"),_=t("../../../Utils/DropSceneMath"),v=t("../../../Unit/Base/UnitDefines"),S=t("../Drop/GridStateDrop"),g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._level=0,e._viewSize=cc.size(0,0),e._cellSize=cc.size(0,0),e._mapSize=cc.size(0,0),e}return n(e,t),e.create=function(t,r,o,n){var i=new e;return i.initWithLevel(t,r,o,n),i},e.prototype.initWithLevel=function(e,r,o,n){t.prototype.init.call(this,d.GridStateType.Create),this._level=e,this._viewSize=r,this._cellSize=o,this._mapSize=n},e.prototype.enter=function(t){t.setCellSize(this._cellSize),t.setMapSize(this._mapSize),t.setOrigin(cc.v2(.5*this._cellSize.width,.5*this._cellSize.height));var e=cc.size(this._cellSize.width*this._mapSize.width,this._cellSize.height*this._mapSize.height);t.node.setContentSize(e);var r=c.default.getScaleFromViewSize(this._viewSize,cc.size(e.width+this._cellSize.width,e.height+this._cellSize.height),.75,1.25);t.node.scale=r,t.addLayer(p.default.create(e,this._mapSize)),t.addLayer(u.default.create(e,this._mapSize)),t.addLayer(l.default.create(e,this._mapSize));var o=a.default.createWithFile(i.AssetBundleID.DropScene,"config/level"+this._level.toString());this.createFloor(o,t),this.createCandy(o,t),this.createFrame(o,t),t.setCurrentState(S.default.create())},e.prototype.createFloor=function(t,e){for(var r={},o=t.getMapSize(),n=0;n<o.width;n++)for(var i=0;i<o.height;i++){var a=cc.v2(n,o.height-1-i),c={},u=t.getObjectInfos("Mark",a);if(u){for(var p=0,l=u;p<l.length;p++){var y=l[p],d=t.getTilesetPropertyWithGID(y.gid);for(var h in d.propertyDict)c[h]=d.propertyDict[h].value;for(var h in y.propertyDict)c[h]=y.propertyDict[h].value}var S=c.kind;if(S==v.UnitKind.MarkEntrance||S==v.UnitKind.MarkExit){var g=c.group;null==r[g]&&(r[g]={entrance:cc.v2(-1,-1),exit:cc.v2(-1,-1)}),S==v.UnitKind.MarkEntrance&&(r[g].entrance=cc.v2(n,i)),S==v.UnitKind.MarkExit&&(r[g].exit=cc.v2(n,i))}}}var F={};for(var h in r){var P=r[h],C={kind:v.UnitKind.FloorEntrance,relatedPosition:P.exit};F[_.default.getKeyWithLogicalPosition(P.entrance)]=C;var U={kind:v.UnitKind.FloorExit,relatedPosition:P.entrance};F[_.default.getKeyWithLogicalPosition(P.exit)]=U}for(n=0;n<o.width;n++){var O=null;for(i=0;i<o.height;i++){a=cc.v2(n,o.height-1-i);var b={},m=t.getTilesetProperty("Floor",a);if(m)for(var B in m.propertyDict)b[B]=m.propertyDict[B].value;var D=F[h=_.default.getKeyWithLogicalPosition(cc.v2(n,i))];if(D)for(var L in D)b[L]=D[L];var w=f.default.createFloor(b);w&&(e.setUnit(s.LayerName.Floor,cc.v2(n,i),w),O=w)}O&&O.setIsSpawn(!0)}},e.prototype.createCandy=function(t,e){for(var r=t.getMapSize(),o=0;o<r.height;o++)for(var n=0;n<r.width;n++){var i={},a=cc.v2(n,r.height-1-o),c=t.getTilesetProperty("Candy",a);if(c)for(var u in c.propertyDict)i[u]=c.propertyDict[u].value;var p=y.default.createCandy(i);p&&e.setUnit(s.LayerName.Candy,cc.v2(n,o),p)}},e.prototype.createFrame=function(t,e){for(var r=t.getMapSize(),o=-1;o<=r.height;o++)for(var n=-1;n<=r.width;n++)if(null==e.getUnit(s.LayerName.Floor,cc.v2(n,o))){var i={kind:v.UnitKind.FrameNormal},a=h.default.createFrame(i);e.setUnit(s.LayerName.Frame,cc.v2(n,o),a)}},e}(d.default);r.default=g,cc._RF.pop()},{"../../../../../../../scripts/Defines/Defines":void 0,"../../../../../../../scripts/Frameworks/TiledMap/TiledMapJsonPhraser":void 0,"../../../../../../../scripts/Frameworks/Utils/GameMath":void 0,"../../../Layer/Base/GridLayerBase":"GridLayerBase","../../../Layer/CandyLayer/CandyLayer":"CandyLayer","../../../Layer/FloorLayer/FloorLayer":"FloorLayer","../../../Layer/FrameLayer/FrameLayer":"FrameLayer","../../../Unit/Base/UnitDefines":"UnitDefines","../../../Unit/Candy/CandyFactory":"CandyFactory","../../../Unit/Floor/FloorFactory":"FloorFactory","../../../Unit/Frame/FrameFactory":"FrameFactory","../../../Utils/DropSceneMath":"DropSceneMath","../Base/GridStateBase":"GridStateBase","../Drop/GridStateDrop":"GridStateDrop"}],GridStateDrop:[function(t,e,r){"use strict";cc._RF.push(e,"a34e1QbYLNCzbHOTCw4yoPr","GridStateDrop");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Layer/Base/GridLayerBase"),a=t("../../../Unit/Base/State/UnitStateBase"),c=t("../Base/GridStateBase"),s=t("../Normal/GridStateNormal"),u=t("./GridDropLogic"),p=t("./GridGenerateLogic"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._dropLogical=null,e._generateLogic=null,e._steps=0,e}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,c.GridStateType.Drop),this._dropLogical=u.default.create(),this._generateLogic=p.default.create()},e.prototype.enter=function(t){this._dropLogical.enter(t),this._generateLogic.enter(t)},e.prototype.update=function(e,r){t.prototype.update.call(this,e,r);for(var o=e.getMapSize(),n=0;n<o.height;n++)for(var c=0;c<o.width;c++){var u=e.getUnit(i.LayerName.Candy,cc.v2(c,n));if(u&&u.getCurrentState().getType()!=a.UnitStateType.Normal)return}var p=this._dropLogical.tryDropAllCandy(e),l=this._generateLogic.generateNewCandy(e);this._steps++,0==p.size&&0==l.size&&e.setCurrentState(s.default.create())},e.prototype.onTouchStart=function(t,e){this._dropLogical.onTouchStart(t,e)},e}(c.default);r.default=l,cc._RF.pop()},{"../../../Layer/Base/GridLayerBase":"GridLayerBase","../../../Unit/Base/State/UnitStateBase":"UnitStateBase","../Base/GridStateBase":"GridStateBase","../Normal/GridStateNormal":"GridStateNormal","./GridDropLogic":"GridDropLogic","./GridGenerateLogic":"GridGenerateLogic"}],GridStateMachine:[function(t,e,r){"use strict";cc._RF.push(e,"e0154eudP9HQZSLkav/Z4Yx","GridStateMachine");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.create=function(t){return new e(t)},e.prototype.getCurrentState=function(){return t.prototype.getCurrentState.call(this)},e.prototype.onTouchStart=function(t){var e=this.getCurrentState();e&&e.onTouchStart(this.getOnwer(),t)},e.prototype.onTouchMove=function(t){var e=this.getCurrentState();e&&e.onTouchMove(this.getOnwer(),t)},e.prototype.onTouchEnd=function(t){var e=this.getCurrentState();e&&e.onTouchEnd(this.getOnwer(),t)},e.prototype.onTouchCancel=function(t){var e=this.getCurrentState();e&&e.onTouchCancel(this.getOnwer(),t)},e}(t("../../../../../../../scripts/Frameworks/EWS/FSM/SimpleStateMachine").default);r.default=i,cc._RF.pop()},{"../../../../../../../scripts/Frameworks/EWS/FSM/SimpleStateMachine":void 0}],GridStateNormal:[function(t,e,r){"use strict";cc._RF.push(e,"bfeb8DN8CxNxpYV5gNQTyS2","GridStateNormal");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Layer/Base/GridLayerBase"),a=t("../Base/GridStateBase"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._lastTouchPosition=cc.v2(-1,-1),e}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,a.GridStateType.Normal)},e.prototype.onTouchStart=function(t,e){var r=t.getLogicalPositionWithPixelPositon(e),o=t.getUnit(i.LayerName.Candy,r);o&&o.setSelected(!o.getSelected()),this._lastTouchPosition=r},e.prototype.onTouchMove=function(t,e){var r=t.getLogicalPositionWithPixelPositon(e);if(!r.equals(this._lastTouchPosition)){var o=t.getUnit(i.LayerName.Candy,r);o&&o.setSelected(!o.getSelected()),this._lastTouchPosition=r}},e.prototype.onTouchEnd=function(){this._lastTouchPosition=cc.v2(-1,-1)},e.prototype.onTouchCancel=function(){this._lastTouchPosition=cc.v2(-1,-1)},e}(a.default);r.default=c,cc._RF.pop()},{"../../../Layer/Base/GridLayerBase":"GridLayerBase","../Base/GridStateBase":"GridStateBase"}],GridStateNull:[function(t,e,r){"use strict";cc._RF.push(e,"99f38R1cVNPb4sz+mEwBXNN","GridStateNull");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("./GridStateBase"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,i.GridStateType.None)},e}(i.default);r.default=a,cc._RF.pop()},{"./GridStateBase":"GridStateBase"}],Grid:[function(t,e,r){"use strict";cc._RF.push(e,"fb2e3PFWblKoI2No//GkVmQ","Grid");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../Layer/Base/GridLayerBase"),c=t("../Utils/DropSceneAssetCache"),s=t("./State/Base/GridStateMachine"),u=t("./State/Create/GridStateCreate"),p=t("./State/Drop/GridStateDrop"),l=cc._decorator,f=l.ccclass,y=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layerRoot=null,e._origin=cc.v2(0,0),e._cellSize=cc.size(75,75),e._mapSize=cc.size(9,12),e._stateMachine=null,e._layers={},e}var r;return n(e,t),r=e,e.create=function(t,e,o,n){var i=c.default.getPrefab("prefab/Game/Grid/Grid");if(i){var a=cc.instantiate(i);if(a){var s=a.getComponent(r);if(s)return s.init(t,e,o,n),s}}return null},e.prototype.getOrigin=function(){return this._origin},e.prototype.setOrigin=function(t){this._origin=t},e.prototype.getCellSize=function(){return this._cellSize},e.prototype.setCellSize=function(t){this._cellSize=t},e.prototype.getMapSize=function(){return this._mapSize},e.prototype.setMapSize=function(t){this._mapSize=t},e.prototype.getStateMachine=function(){return this._stateMachine},e.prototype.getCurrentState=function(){return this._stateMachine.getCurrentState()},e.prototype.setCurrentState=function(t){this._stateMachine.setCurrentState(t)},e.prototype.getLayers=function(){return this._layers},e.prototype.getPixelPositionWithLogicalPositon=function(t){return cc.v2(this._cellSize.width*t.x,this._cellSize.height*t.y).add(this._origin)},e.prototype.getLogicalPositionWithPixelPositon=function(t){var e=Math.floor(t.x/this._cellSize.width),r=Math.floor(t.y/this._cellSize.height);return cc.v2(e,r)},e.prototype.getLayer=function(t){return this._layers[t]},e.prototype.addLayer=function(t){t.grid=this,this._layers[t.id]=t,this.layerRoot.addChild(t.node)},e.prototype.removeLayer=function(t){var e=this._layers[t];return e&&(e.node.parent=null,e.grid=null),e},e.prototype.getUnit=function(t,e){var r=this.getLayer(t);return r?r.getUnit(e):null},e.prototype.setUnit=function(t,e,r){var o=this.getLayer(t);o&&o.setUnit(e,r)},e.prototype.removeUnit=function(t,e){var r=this.getLayer(t);return r?r.removeUnit(e):null},e.prototype.onTouchStart=function(t){var e=this.layerRoot.convertToNodeSpaceAR(t.getLocation());this._stateMachine.onTouchStart(e)},e.prototype.onTouchMove=function(t){var e=this.layerRoot.convertToNodeSpaceAR(t.getLocation());this._stateMachine.onTouchMove(e)},e.prototype.onTouchEnd=function(t){var e=this.layerRoot.convertToNodeSpaceAR(t.getLocation());this._stateMachine.onTouchEnd(e)},e.prototype.onTouchCancel=function(t){var e=this.layerRoot.convertToNodeSpaceAR(t.getLocation());this._stateMachine.onTouchCancel(e)},e.prototype.init=function(t,e,r,o){this._stateMachine=s.default.create(this),this.setCurrentState(u.default.create(t,e,r,o))},e.prototype.updateGrid=function(t){this._stateMachine.update(t)},e.prototype.clearSelectedCandy=function(){for(var t=this.getMapSize(),e=0;e<t.height;e++)for(var r=0;r<t.width;r++){var o=this.getUnit(a.LayerName.Candy,cc.v2(r,e));o&&o.getSelected()&&this.removeUnit(a.LayerName.Candy,cc.v2(r,e))}this.setCurrentState(p.default.create())},i([y(cc.Node)],e.prototype,"layerRoot",void 0),r=i([f],e)}(cc.Component);r.default=d,cc._RF.pop()},{"../Layer/Base/GridLayerBase":"GridLayerBase","../Utils/DropSceneAssetCache":"DropSceneAssetCache","./State/Base/GridStateMachine":"GridStateMachine","./State/Create/GridStateCreate":"GridStateCreate","./State/Drop/GridStateDrop":"GridStateDrop"}],MarkBase:[function(t,e,r){"use strict";cc._RF.push(e,"61df2zFAh9H4I23RMxCJHXu","MarkBase");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../Base/UnitBase"),c=t("../../Base/UnitDefines"),s=t("./State/MarkStateNormal"),u=cc._decorator,p=u.ccclass,l=(u.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.initMark=function(e){t.prototype.initUnit.call(this,c.UnitCategory.Mark,e),this.setCurrentState(s.default.create())},i([p],e)}(a.default));r.default=l,cc._RF.pop()},{"../../Base/UnitBase":"UnitBase","../../Base/UnitDefines":"UnitDefines","./State/MarkStateNormal":"MarkStateNormal"}],MarkFactory:[function(t,e,r){"use strict";cc._RF.push(e,"886c7LFkgROmrLniNWr4Fdl","MarkFactory"),Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Base/UnitDefines"),n=function(){function t(){}return t.createMark=function(t){switch(t.kind){case o.UnitKind.MarkEntrance:case o.UnitKind.MarkExit:}return null},t}();r.default=n,cc._RF.pop()},{"../Base/UnitDefines":"UnitDefines"}],MarkStateNormal:[function(t,e,r){"use strict";cc._RF.push(e,"1b6c39e3/5Pc4YTOEBUrLAg","MarkStateNormal");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../Base/State/UnitStateBase"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,i.UnitStateType.Normal)},e}(i.default);r.default=a,cc._RF.pop()},{"../../../Base/State/UnitStateBase":"UnitStateBase"}],UnitBase:[function(t,e,r){"use strict";cc._RF.push(e,"0ba4esNfHlCOq6cxfHMl7fl","UnitBase");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("./State/UnitStateMachine"),c=t("./State/UnitStateNull"),s=t("./UnitDefines"),u=cc._decorator,p=u.ccclass,l=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._unitCategory=s.UnitCategory.None,e._unitKind=s.UnitKind.None,e._healthPoint=1,e._unitColor=s.UnitColor.None,e._layer=null,e._logicalPostion=cc.v2(0,0),e._stateMachine=null,e}return n(e,t),e.prototype.getUnitCategory=function(){return this._unitCategory},e.prototype.setUnitCategory=function(t){this._unitCategory=t},e.prototype.getUnitKind=function(){return this._unitKind},e.prototype.setUnitKind=function(t){this._unitKind=t},e.prototype.getHP=function(){return this._healthPoint},e.prototype.setHp=function(t){this._healthPoint=t},e.prototype.getColor=function(){return this._unitColor},e.prototype.setColor=function(t){this._unitColor=t},Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},set:function(t){this._layer=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"grid",{get:function(){return this._layer.grid},enumerable:!1,configurable:!0}),e.prototype.getLogicalPostion=function(){return this._logicalPostion},e.prototype.setLogicalPostion=function(t){this._logicalPostion=t},e.prototype.getPixelPosition=function(){return this.node.getPosition()},e.prototype.setPixelPosition=function(t){this.node.setPosition(t)},e.prototype.getStateMachine=function(){return this._stateMachine},e.prototype.getCurrentState=function(){return this._stateMachine.getCurrentState()},e.prototype.setCurrentState=function(t){this._stateMachine.setCurrentState(t)},e.prototype.initUnit=function(t,e){this.setUnitCategory(t),this.setUnitKind(e),this._stateMachine=a.default.create(this),this.setCurrentState(c.default.create())},e.prototype.updateUnit=function(t){this._stateMachine.update(t)},i([p],e)}(cc.Component));r.default=l,cc._RF.pop()},{"./State/UnitStateMachine":"UnitStateMachine","./State/UnitStateNull":"UnitStateNull","./UnitDefines":"UnitDefines"}],UnitDefines:[function(t,e,r){"use strict";cc._RF.push(e,"bccff6pj4VO5JV5qrwQC5K5","UnitDefines"),Object.defineProperty(r,"__esModule",{value:!0}),r.UnitKind=r.UnitColor=r.UnitCategory=void 0,function(t){t[t.None=0]="None",t[t.Frame=1e4]="Frame",t[t.Floor=2e4]="Floor",t[t.Candy=6e4]="Candy",t[t.Mark=9e4]="Mark"}(r.UnitCategory||(r.UnitCategory={})),function(t){t[t.None=0]="None",t[t.Begin=1]="Begin",t[t.Red=1]="Red",t[t.Green=2]="Green",t[t.Blue=3]="Blue",t[t.Yellow=4]="Yellow",t[t.Orange=5]="Orange",t[t.Purple=6]="Purple",t[t.End=7]="End"}(r.UnitColor||(r.UnitColor={})),function(t){t[t.None=0]="None",t[t.FrameNormal=10001]="FrameNormal",t[t.FloorFixed=20001]="FloorFixed",t[t.FloorEntrance=20002]="FloorEntrance",t[t.FloorExit=20003]="FloorExit",t[t.CandyFruit=60001]="CandyFruit",t[t.CandyCake=60002]="CandyCake",t[t.MarkEntrance=90001]="MarkEntrance",t[t.MarkExit=90002]="MarkExit"}(r.UnitKind||(r.UnitKind={})),cc._RF.pop()},{}],UnitStateBase:[function(t,e,r){"use strict";cc._RF.push(e,"353a97rwdVBAoau828cyQHZ","UnitStateBase");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.UnitStateType=void 0;var i,a=t("../../../../../../../scripts/Frameworks/EWS/FSM/State");(function(t){t[t.None=0]="None",t[t.Normal=1]="Normal",t[t.Drop=2]="Drop",t[t.Born=3]="Born"})(i=r.UnitStateType||(r.UnitStateType={}));var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._type=i.None,e}return n(e,t),e.prototype.getType=function(){return this._type},e.prototype.init=function(t){this._type=t},e.prototype.enter=function(){},e.prototype.update=function(){},e.prototype.exit=function(){},e.prototype.onMessage=function(){return!1},e.prototype.reset=function(){},e}(a.default);r.default=c,cc._RF.pop()},{"../../../../../../../scripts/Frameworks/EWS/FSM/State":void 0}],UnitStateMachine:[function(t,e,r){"use strict";cc._RF.push(e,"5f543a9RFVKp5nDcE9IKlbS","UnitStateMachine");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=this&&this.__decorate||function(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a};Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../../../../../../scripts/Frameworks/EWS/FSM/SimpleStateMachine"),c=cc._decorator,s=c.ccclass,u=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var r;return n(e,t),r=e,e.create=function(t){return new r(t)},e.prototype.getCurrentState=function(){return t.prototype.getCurrentState.call(this)},e.prototype.setCurrentState=function(e){t.prototype.setCurrentState.call(this,e)},r=i([s],e)}(a.default));r.default=u,cc._RF.pop()},{"../../../../../../../scripts/Frameworks/EWS/FSM/SimpleStateMachine":void 0}],UnitStateNull:[function(t,e,r){"use strict";cc._RF.push(e,"2f364SEmmNF3LxW89hUfiTN","UnitStateNull");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var i=t("./UnitStateBase"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.create=function(){var t=new e;return t.init(),t},e.prototype.init=function(){t.prototype.init.call(this,i.UnitStateType.None)},e}(i.default);r.default=a,cc._RF.pop()},{"./UnitStateBase":"UnitStateBase"}]},{},["DropScene","Grid","GridStateBase","GridStateMachine","GridStateNull","GridStateCreate","GridDropLogic","GridGenerateLogic","GridStateDrop","GridStateNormal","GridLayerBase","CandyLayer","FloorLayer","FrameLayer","UnitStateBase","UnitStateMachine","UnitStateNull","UnitBase","UnitDefines","CandyBase","CandyStateBorn","CandyStateDrop","CandyStateNormal","CandyStateTeleport","CandyCake","CandyFactory","CandyFruit","FloorBase","FloorStateNormal","FloorEntrance","FloorExit","FloorFixed","FloorFactory","FrameBase","FrameStateNormal","FrameFactory","FrameNormal","MarkBase","MarkStateNormal","MarkFactory","DropSceneAssetCache","DropSceneMath"]);